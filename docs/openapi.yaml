openapi: 3.0.3
info:
  title: VOTUX Backend API
  version: '1.0.0'
  description: API pour le système de vote électronique VOTUX
servers:
  - url: http://localhost:3001/api
    description: Dev server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    LoginRequest:
      type: object
      required: [matricule, password]
      properties:
        matricule:
          type: string
        password:
          type: string
    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        token:
          type: string
        user:
          type: object
          properties:
            id: { type: integer }
            isAdmin: { type: boolean }
            type: { type: string, enum: [admin, voter] }
    Election:
      type: object
      properties:
        id: { type: integer }
        title: { type: string }
        description: { type: string }
        start_date: { type: string, format: date-time }
        end_date: { type: string, format: date-time }
        status: { type: string, enum: [pending, ongoing, closed, cancelled] }
        created_by: { type: integer }
        is_public: { type: boolean }
        max_votes: { type: integer }
        created_by_name: { type: string }
        candidates:
          type: array
          items:
            $ref: '#/components/schemas/Candidate'
    Candidate:
      type: object
      properties:
        id: { type: integer }
        election_id: { type: integer }
        name: { type: string }
        description: { type: string }
        photo_url: { type: string, nullable: true }
        order_position: { type: integer }
    Voter:
      type: object
      properties:
        id: { type: integer }
        matricule: { type: string }
        full_name: { type: string }
        email: { type: string, nullable: true }
        promotion: { type: string, nullable: true }
    EligibleVotersRequest:
      type: object
      required: [voterIds]
      properties:
        voterIds:
          type: array
          items: { type: integer }
    VoteRequest:
      type: object
      required: [electionId, candidateId]
      properties:
        electionId: { type: integer }
        candidateId: { type: integer }
    ErrorResponse:
      type: object
      properties:
        success: { type: boolean }
        error: { type: string }
        message: { type: string }
security:
  - bearerAuth: []
paths:
  /auth/login:
    post:
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }
  /elections:
    get:
      tags: [Elections]
      security: [ { bearerAuth: [] } ]
      responses:
        '200':
          description: List elections
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Election' }
    post:
      tags: [Elections]
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, start_date, end_date]
              properties:
                title: { type: string }
                description: { type: string }
                start_date: { type: string, format: date-time }
                end_date: { type: string, format: date-time }
                is_public: { type: boolean }
                max_votes: { type: integer }
                candidates:
                  type: array
                  items:
                    type: object
                    required: [name]
                    properties:
                      name: { type: string }
                      description: { type: string }
                      order_position: { type: integer }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Election' }
  /elections/{id}/candidates:
    get:
      tags: [Elections]
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Candidates
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Candidate' }
  /elections/{id}/start:
    post:
      tags: [Elections]
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Started
  /elections/{id}/tally:
    post:
      tags: [Elections]
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Tallied
  /elections/{id}/eligible-voters:
    get:
      tags: [Eligibility]
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Eligible voters
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Voter' }
    post:
      tags: [Eligibility]
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/EligibleVotersRequest' }
      responses:
        '200':
          description: Updated
  /elections/{id}/eligible-voters/{voterId}:
    delete:
      tags: [Eligibility]
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: path
          name: voterId
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Removed
  /vote:
    post:
      tags: [Vote]
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/VoteRequest' }
      responses:
        '200':
          description: Vote accepted
        '400':
          description: Invalid
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
